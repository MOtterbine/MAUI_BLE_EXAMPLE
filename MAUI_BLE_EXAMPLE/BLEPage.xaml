<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="False"
             
             NavigationPage.HasNavigationBar="False"
             
             Background="#e7e7e7"
             IsEnabled="{Binding IsBusy, Converter={converters:InvertedBoolConverter}}"
             xmlns:behaviors="clr-namespace:MAUI_BLE_EXAMPLE.Behaviors"
             xmlns:converters="clr-namespace:MAUI_BLE_EXAMPLE.Converters"
             x:Class="MAUI_BLE_EXAMPLE.BLEPage">

    <ContentPage.Resources>

        
        <Style x:Key="ParamTitle" TargetType="Label">
            <Setter Property="TextColor" Value="#444" />
            <Setter Property="HorizontalTextAlignment" Value="Center" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="VerticalOptions" Value="Start" />
            <Setter Property="VerticalTextAlignment" Value="Start" />
            <Setter Property="FontAttributes" Value="Bold" />

        </Style>


    </ContentPage.Resources>
    
    <ScrollView Padding="0">
        <Grid Padding="0" Margin="0" RowSpacing="0">
            
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"></RowDefinition>
                <RowDefinition Height="Auto"></RowDefinition>
                <RowDefinition Height="*"></RowDefinition>
            </Grid.RowDefinitions>
            
            <!-- Main Title -->
            <VerticalStackLayout Grid.Row="0" Margin="15,20,15,5">
                <Label
                    Text="{OnPlatform WinUI='MAUI BLE Example', Android='BLE Example'}"
                    Style="{StaticResource SubHeadline}" FontSize="26" Margin="0" Padding="0"
                    SemanticProperties.HeadingLevel="Level1" />
                <Label
                    Text="{OnPlatform WinUI='for Windows', Android='for Android'}" FontSize="Small"
                    HorizontalTextAlignment="Center" Margin="0" Padding="0"
                    SemanticProperties.HeadingLevel="Level1" />
                <Label 
                    Text="{Binding Version, StringFormat='v{0}'}"  FontSize="Micro"
                    Style="{StaticResource SubHeadline}" Margin="0" Padding="0" />

            </VerticalStackLayout>
            
            <!-- Body -->
            <VerticalStackLayout Grid.Row="1"
                VerticalOptions="Center"
                Padding="30,10"
                Spacing="15">
                <Border >
                    <Grid>
                    
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"></ColumnDefinition>
                            <ColumnDefinition Width="1*"></ColumnDefinition>
                        </Grid.ColumnDefinitions>

                        <!-- Temperature -->
                        <Border Grid.Row="0" Grid.Column="0">
                            <HorizontalStackLayout HorizontalOptions="Center">
                                <VerticalStackLayout HorizontalOptions="Center">
                                    <Label Style="{StaticResource ParamTitle}" Text="Temperature"></Label>
                                    <Label HorizontalTextAlignment="Center" FontSize="28" Padding="0,0" Margin="0,0" VerticalOptions="Center" VerticalTextAlignment="Center" FontAttributes="Bold" Text="{Binding Temperature, StringFormat='{0:f0}º'}"></Label>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>
                        </Border>


                        <!-- Button -->
                        <Border Grid.Row="0" Grid.Column="1">
                                <VerticalStackLayout HorizontalOptions="Center" Margin="0" Padding="0" >
                                    <Label Style="{StaticResource ParamTitle}" Text="Button"></Label>
                                    <Label HorizontalTextAlignment="Center" HorizontalOptions="Center" FontSize="28"  Padding="0" Margin="0"
                                        VerticalOptions="Center" VerticalTextAlignment="Center" FontAttributes="Bold"  Text="{Binding ButtonValue, Converter={converters:ByteToButtonText}}"></Label>
                                </VerticalStackLayout>
                        </Border>

                       
                        <!-- Device Message -->
                        <Border Grid.Row="2" Grid.ColumnSpan="3" >
                            <Grid >
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Label Grid.Row="0" HorizontalTextAlignment="Start" HorizontalOptions="Start" Padding="0,0" Margin="5,0,0,10" 
                                       VerticalOptions="Start" VerticalTextAlignment="Start" FontAttributes="Bold"  Text="{Binding DeviceName, StringFormat='Device: {0}'}" LineBreakMode="TailTruncation"></Label>
                                <!-- Device Message -->
                                <Label Grid.Row="1"  HorizontalTextAlignment="Start" Padding="0,0" Margin="5,0,0,10" VerticalOptions="Center" 
                                       VerticalTextAlignment="Center" FontAttributes="Bold"  Text="{Binding DeviceMessage}" LineBreakMode="TailTruncation"></Label>
                            </Grid>
                        </Border>



                        <Border Grid.Row="3" Grid.Column="0" 
                            ToolTipProperties.Text="Toggles PWM power">

                            <HorizontalStackLayout HorizontalOptions="Center" Padding="0" Margin="0" Spacing="0" >
                                <!-- LED Switch -->
                                <Button
                                            Margin="10"
                                            WidthRequest="70"
                                            HeightRequest="{OnPlatform 50, WinUI=70}"
                                            FontSize="30"
                                            Text="{Binding ToggleButtonText}"
                                            IsEnabled="{Binding CanSend}"
                                            Padding="15,2"
                                            SemanticProperties.Hint="Sends the specified string"
                                            Clicked="OnBLEButtonClicked_Toggle"
                                            behaviors:CursorBehavior.Cursor="Hand"
                                            HorizontalOptions="Fill"   ></Button>


                            </HorizontalStackLayout>
                        </Border>

                        <Border Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2" 
                                ToolTipProperties.Text="Sets the percent pulse-width-modulation (PWM) value">
                            <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Padding="0" Margin="0" Spacing="0" >
                                    <Label Style="{StaticResource ParamTitle}" Text="PWM (%)" VerticalOptions="Start"></Label>
                                    <!-- PWM -->
                                    <Entry
                                        VerticalOptions="Center"
                                        MaxLength="3"
                                        behaviors:PercentValidationBehavior.AttachBehavior="True"
                                        HorizontalTextAlignment="End"
                                            Margin="0"
                                            WidthRequest="65"
                                            HeightRequest="50"
                                            FontSize="25"
                                            Text="{Binding PWM}"
                                            IsEnabled="{Binding CanSend}"
                                            Completed="OnPWMCompleted"
                                            SemanticProperties.Hint="Sets the percent pulse-width-modulation (PWM) value"
                                            
                                            Focused="OnPWMFocused"
                                            HorizontalOptions="End" />

                            </VerticalStackLayout>
                        </Border>
                 

                    </Grid>
                </Border>

            
            </VerticalStackLayout>
            
            <Grid VerticalOptions="End" Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Label Padding="0" Margin="5" Grid.Row="0" VerticalOptions="End" VerticalTextAlignment="End"
                    Text="{Binding StatusMessage}" 
                    Style="{StaticResource StatusMessageStyle}"  />
            </Grid>

        </Grid>
    </ScrollView>

</ContentPage>
